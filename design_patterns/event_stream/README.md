┌─────────────────────────────────────────────────────────────┐
│                    External APIs (Google RCS)               │
│                      Events Stream                          │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│              BatchEventProcessor (Optional)                 │
│  - Event Deduplication (Bloom Filter)                       │
│  - Priority Queue                                           │
│  - Batch Processing                                         │
│  - Circuit Breaker                                          │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                MessageStateManager                          │
│  - Event Router                                             │
│  - State Storage (HashMap)                                  │
│  - Callback Manager                                         │
│  - Audit Logger                                             │
└────────────────────┬────────────────────────────────────────┘
                     │
         ┌───────────┼───────────┐
         ▼           ▼           ▼
    ┌────────┐  ┌────────┐  ┌────────┐
    │Handler │  │Handler │  │Handler │
    │  #1    │  │  #2    │  │  #3    │
    └────────┘  └────────┘  └────────┘
         │           │           │
         └───────────┼───────────┘
                     ▼
            ┌─────────────────┐
            │  Message State  │
            │   Transition    │
            └─────────────────┘